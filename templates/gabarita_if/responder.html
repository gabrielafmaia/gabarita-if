{% extends "base.html" %} {% load static %} {% block content %}

<section>
  <div class="m-auto" style="max-width: 80rem">
    <a href="{% url url_voltar %}" class="back-link">
      <i class="fa-solid fa-arrow-left" style="margin-right: 3px"></i> Voltar
    </a>
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="fw-bold mb-0">{{ object.titulo }} {{ object.ano }}</h1>
      {% if tentativa and tentativa.finalizada %}
      <span class="badge fs-6" style="background: var(--primary-color); color: white">Avaliação finalizada</span>
      {% endif %}
    </div>
    <form method="POST">
      {% csrf_token %}
      <div class="d-flex flex-column gap-3">
        {% for object in objects %}
        <div class="col">
          <div class="card mb-3" style="background-color: var(--bs-white); padding: 32px">
            {% include "gabarita_if/partials/_questao_header.html" %}
            <div class="card-body">
              {% include "gabarita_if/partials/_questao_textos.html" %}
              <!-- ALTERNATIVAS -->
              {% for letra, texto in object.alternativas.items %}
              <div
                class="alternativa-container d-flex align-items-center rounded-lg mb-3 p-3"
                style="
                  {% if mostrar_feedback and object.resposta %}
                    {% if letra == object.alternativa_correta %}
                      background-color: var(--primary-emphasis);
                    {% elif letra == object.resposta.alternativa_escolhida %}
                      background-color: var(--danger-emphasis);
                    {% endif %}
                  {% endif %}
                "
              >
                <div class="d-flex align-items-center gap-3 m-auto flex-grow-1">
                  <label class="fw-semibold">{{ letra }})</label>

                  <input type="radio" name="questao_{{ object.id }}" value="{{ letra }}" class="form-check-input
                  custom-radio" 
                  {% if mostrar_feedback or tentativa.finalizada %}disabled{% endif %} 
                  {% if object.resposta and object.resposta.alternativa_escolhida == letra %}checked{% endif %} 
                  {% if not mostrar_feedback and not tentativa.finalizada %}required{% endif %} > 
                  {{ texto|safe }}
                </div>
              </div>
              {% endfor %} {% if mostrar_feedback %} {% include "gabarita_if/partials/_questao_feedback.html" %} {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% if not tentativa.finalizada %}
      <input type="submit" value="Finalizar" class="btn btn-primary btn-long w-100 form-btn" />
      {% else %}
      <a href="{% if tipo_avaliacao == 'prova' %}{% url 'gabarita_if:responder-prova' object.id %}{% else %}{% url 'gabarita_if:responder-simulado' object.id %}{% endif %}" class="btn btn-secondary btn-long w-100 form-btn">
      Tentar novamente
      </a>
      {% endif %}
    </form>
  </div>
</section>
{% endblock %}
