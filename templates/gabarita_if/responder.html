{% extends "base.html" %} 
{% load static %}
{% block content %}

<section>
  <div class="m-auto" style="max-width: 80rem">
    <div class="card mb-4 d-flex flex-column align-items-center" style="padding: 6rem; background-image: linear-gradient(to bottom right, var(--danger-color), var(--primary-dark)); color: white !important">
      {% if simulado %}<img src="{% static logo %}" alt="" class="img-fluid" width="100">{% endif %}
      {% if prova %}<img src="{% static logo %}" alt="" class="img-fluid" width="215">{% endif %}
      <h2 class="mt-4 mb-2 text-center fs-1 fw-bold" style="color: white !important">{{ simulado.titulo }} {{ prova.titulo }} {{ simulado.ano }} {{ prova.ano }}</h2>
      <p class="text-center">{{ simulado.subtitulo }} {{ prova.instituicao }}</p>
    </div>

    <!-- Textos de Apoio do Simulado -->
    <div class="mb-4">
      {% for texto in simulado.textodeapoio_set.all %}
      <div class="accordion mb-2">
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button
              class="accordion-button collapsed"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#collapse{{ texto.id }}"
            >
              {{ texto.titulo }}
            </button>
          </h2>
          <div id="collapse{{ texto.id }}" class="accordion-collapse collapse">
            <div class="accordion-body">
              {% if texto.texto %}
              <p class="m-0" style="text-align: justify">{{ texto.texto|safe }}</p>
              {% endif %} {% if texto.imagem %}
              <img src="{{ texto.imagem.url }}" class="img-fluid" alt="{{ texto.titulo }}" style="max-width: 100%" />
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <form method="POST">
      {% csrf_token %} 
      <div class="d-flex flex-column gap-4">
        {% for object in objects %}
        <div class="col">
          <div class="card mb-3" style="background-color: var(--bs-white); padding: 32px">
            <!-- Título da prova/simulado -->
            <div class="card-header text-center mb-4" style="all: unset">
              {% if object.prova %}
              <p class="fw-bold m-0">{{ object.prova.titulo }} {{ object.prova.ano }} | {{ object.prova.instituicao }}</p>
              {% endif %} {% for simulado_item in object.simulados.all %}
              <p class="fw-bold m-0">{{ simulado_item.titulo }} {{ simulado_item.ano }}</p>
              {% endfor %}
            </div>

            <div class="card-body">
              <p class="mb-4">{{ object.enunciado|safe }}</p>

              {% if object.imagem %}
              <img src="{{ object.imagem.url }}" class="img-fluid mb-4" style="width: 15rem" />
              {% endif %}

              <!-- Alternativas -->
              {% for letra, texto in object.alternativas.items %}
              <div
                class="alternativa-container d-flex align-items-center rounded-lg mb-3 p-3"
                style="
                {% if object.resposta %}
                    {% if letra == object.alternativa_correta %} 
                        background-color: var(--primary-emphasis);
                    {% elif letra == object.resposta.alternativa_escolhida %}
                        background-color: var(--danger-emphasis);
                    {% endif %}
                {% endif %}"
              >
                <div class="d-flex align-items-center gap-3 m-auto flex-grow-1">
                  <label class="fw-semibold text-lg cursor-pointer">{{ letra }})</label>
                  <input type="radio" name="questao_{{ object.id }}" value="{{ letra }}" class="form-check-input
                  custom-radio" {% if forloop.first %}required{% endif %} {% if object.resposta and object.resposta.alternativa_escolhida == letra %}checked{% endif %} > {{ texto|safe }}
                </div>
              </div>
              {% endfor %}

              <!-- Feedback -->
              {% if object.resposta %} {% if object.resposta.acertou %}
              <div
                style="background: var(--primary-color); width: fit-content; color: white; border-radius: 12px"
                class="p-5 my-4 d-flex gap-4 align-items-center"
              >
                <i class="fa-solid fa-circle-check fa-4x" style="color: white"></i>
                <div>
                  <h5 class="fw-semibold">Boa, futuro federal! Você acertou!</h5>
                  <span>Você está mandando bem, continue assim!</span>
                </div>
              </div>
              {% else %}
              <div
                style="background: var(--danger-color); width: fit-content; color: white; border-radius: 12px"
                class="p-5 my-4 d-flex gap-4 align-items-center"
              >
                <i class="fa-solid fa-circle-xmark fa-4x" style="color: white"></i>
                <div>
                  <h5 class="fw-semibold">Poxa, futuro federal! Não foi dessa vez!</h5>
                  <span>A alternativa correta é {{ object.alternativa_correta }}</span>
                </div>
              </div>
              {% endif %}

              <!-- Resoluções -->
              <ul class="nav nav-tabs" role="tablist">
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link active"
                    data-bs-toggle="tab"
                    data-bs-target="#gabarito-{{ object.id }}"
                    type="button"
                  >
                    Gabarito comentado
                  </button>
                </li>
                {% if object.video_solucao %}
                <li class="nav-item" role="presentation">
                  <button class="nav-link" data-bs-toggle="tab" data-bs-target="#video-{{ object.id }}" type="button">
                    Vídeo solução
                  </button>
                </li>
                {% endif %}
              </ul>
              <div class="tab-content border border-top-0 rounded-bottom" style="padding: 20px">
                <div class="tab-pane fade show active" id="gabarito-{{ object.id }}">
                  <p class="m-0">{{ object.gabarito_comentado|safe }}</p>
                </div>
                {% if object.video_solucao %}
                <div class="tab-pane fade" id="video-{{ object.id }}">
                  <a href="{{ object.video_solucao }}" target="_blank" class="btn btn-primary">
                    Assistir ao vídeo
                    <i class="fa-solid fa-arrow-up-right-from-square ms-1"></i>
                  </a>
                </div>
                {% endif %}
              </div>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      <div class="text-end">
        <input type="submit" class="btn btn-primary form-btn" value="Finalizar">
      </div>
    </form>
  </div>
</section>
{% endblock %}
