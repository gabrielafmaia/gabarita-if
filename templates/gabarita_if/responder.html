{% extends "base.html" %} {% load static %} {% block content %}
<section>
  <div class="m-auto" style="max-width: 80rem">
    <div class="mb-2">
      <a href="{% url url_voltar %}" class="back-link">
        <i class="fa-solid fa-arrow-left" style="margin-right: 3px"></i> Voltar
      </a>
    </div>

    {% if mostrar_feedback %}
    <div
      class="rounded d-flex justify-content-between mb-2"
      style="padding: 15px 20px; border: 1px solid var(--bs-border-color)"
    >
      <div>
        <span style="color: var(--primary-color)" class="me-3"><strong> Avaliação finalizada</strong></span>
      </div>
      <div>
        <span class="me-3"><strong>Respondidas:</strong> {{ total_respondidas }}</span>
        <span class="me-3"><strong>Acertos:</strong> {{ total_acertos }}</span>
        <span><strong>Erros:</strong> {{ total_erros }}</span>
      </div>
    </div>
    {% endif %}

    <div class="card d-flex flex-row align-items-center gap-3 mb-3 responder-titulo">
      {% if mostrar_feedback %}<i class="fa-solid fa-file-circle-check icon-responder"></i>
      {% else %}
      <i class="fa-solid fa-file-pen icon-responder"></i>
      {% endif %}
      <h3 class="fw-bold mb-0">Responder {{ object.titulo }} - {{ object.ano }}</h3>
    </div>

    {% if not mostrar_feedback %}
    <form method="POST">
      {% csrf_token %} {% endif %}
      <div class="d-flex flex-column gap-3">
        {% for object in objects %}
        <div class="col">
          <div class="card" style="background-color: var(--bs-white); padding: 32px">
            {% include "gabarita_if/partials/_questao_header.html" %}
            <div class="card-body">
              {% include "gabarita_if/partials/_questao_textos.html" %}
              <!-- Alternativas -->
              {% for letra, texto in object.alternativas.items %}
              <div
                class="alternativa-container d-flex align-items-center rounded-lg p-3 {% if not forloop.last %}mb-3{% endif %}"
                style="
                  {% if mostrar_feedback and object.resposta %}
                    {% if letra == object.alternativa_correta %}
                      background-color: var(--primary-emphasis);
                    {% elif letra == object.resposta.alternativa_escolhida %}
                      background-color: var(--danger-emphasis);
                    {% endif %}
                  {% endif %}
                "
              >
                <div class="d-flex align-items-center gap-3 m-auto flex-grow-1">
                  <label class="fw-semibold">{{ letra }})</label>

                  {% if mostrar_feedback %} <input type="radio" name="questao_{{ object.id }}" class="form-check-input
                  custom-radio" disabled {% if object.resposta and object.resposta.alternativa_escolhida == letram%}checked{% endif %}> 
                  {% else %}
                  <input
                    type="radio"
                    name="questao_{{ object.id }}"
                    value="{{ letra }}"
                    class="form-check-input custom-radio"
                    required
                  />
                  {% endif %}
                  <span class="alternativa-text ms-2">{{ texto|safe }}</span>

                  <div class="ms-auto">
                    <button
                      type="button"
                      style="all: unset; cursor: pointer; {% if object.resposta %}opacity: .5;{% endif %}"
                      class="btn-scissors btn btn-link p-0"
                      style="color: inherit"
                      aria-pressed="false"
                      aria-label="Riscar alternativa"
                      {% if object.resposta %}disabled{% endif %}
                    >
                      <i class="fa-solid fa-scissors"></i>
                    </button>
                  </div>
                </div>
              </div>
              {% endfor %} 
              {% if mostrar_feedback %} 
              {% include "gabarita_if/partials/_questao_feedback.html" %} 
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      {% if not mostrar_feedback %}
      <input type="submit" value="Responder" class="btn btn-primary btn-long w-100 form-btn" />
      {% endif %} {% if not mostrar_feedback %}
    </form>
    {% endif %} {% if mostrar_feedback %}
    <a href="{% url url_responder object.id %}" class="btn btn-secondary btn-long w-100 form-btn"> Tentar novamente </a>
    {% endif %}
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener("click", function (e) {
    var btn = e.target.closest(".btn-scissors");
    if (!btn) return;
    var container = btn.closest(".alternativa-container");
    if (!container) return;
    var text = container.querySelector(".alternativa-text");
    if (!text) return;
    text.classList.toggle("text-line-through");
    // toggle aria-pressed for accessibility
    var pressed = btn.getAttribute("aria-pressed") === "true";
    btn.setAttribute("aria-pressed", (!pressed).toString());
  });
</script>
{% endblock scripts %}